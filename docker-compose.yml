version: '3.8'

services:

  db-service:
    image: mysql:8.0
    command: --default-authentication-plugin=mysql_native_password
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: root
    volumes:
      - type: volume
        source: blogDB
        target: /var/lib/mysql
    ports:
      - "3301:3306"

  phpmyadmin-service:
    image: phpmyadmin:latest
    container_name: phpmyadmin_dev_interface
    restart: always
    depends_on:
      - db-service
    ports:
      - "8080:80"
    environment:
      PMA_HOST: db-service
  
  
  proxy:
    build:
      context: .
      dockerfile: Dockerfile.proxy
    restart: always
    volumes:
      #- type: bind
      #  source: /folder_key_host # exemple /root/.acme.sh/mon_domain
      #  target: /certs
      - type: bind
        target: /var/www/diablo4Blog/html   # cible dans docker
        source: ./html # folder app côté host
      # - type: bind
      #   target: /var/www/html/projet2
      #   source: ./projet2
    depends_on:
      - diablo4
      - db-service
    ports:
      - "80:80"
      - "443:443"
    
  diablo4:
    build:
      context: .
      dockerfile: Dockerfile.p1
    restart: always
    volumes:
      - type: volume
        target: /var/www/diablo4Blog/html/vendor
      - type: bind
        target: /var/www/diablo4Blog/html
        source: ./html
    depends_on:
      - db-service

volumes:
  blogDB: 
    external: true